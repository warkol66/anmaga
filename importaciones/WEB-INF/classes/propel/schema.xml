<database defaultIdMethod="native" name="anmaga" >

 <table name="users_user" phpName='User' description="Users">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="User Id" autoIncrement="true"/>
  <column name="username" required="true"  type="VARCHAR" size="255" description="username"/>
  <column name="password" required="true"  type="VARCHAR" size="255" description="password"/>
  <column name="active" required="true"  type="BOOLEAN"  description="Is user active?"/>
  <column name="created" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="updated" required="true"  type="TIMESTAMP"  description="Last update date"/>
  <column name="levelId" type="INTEGER" description="User Level" />
  <column name="lastLogin" type="TIMESTAMP" description="Fecha del ultimo login del usuario" />
	<unique>
		<unique-column name="username" />
	</unique>
  <foreign-key foreignTable="users_userInfo" >
    <reference local="id" foreign="userId" />
  </foreign-key>
  <foreign-key foreignTable="users_level" >
    <reference local="levelId" foreign="id" />
  </foreign-key>
 </table>

 <table name="users_userInfo" phpName='UserInfo' description="Information about users">
  <column name="userId" required="true" primaryKey="true" type="INTEGER" description="User Id" />
  <column name="name" type="VARCHAR" size="255" description="name"/>
  <column name="surname" type="VARCHAR" size="255" description="surname"/>
  <column name="mailAddress" type="VARCHAR" size="255" description="Email" />
	<foreign-key foreignTable="users_user" >
      <reference local="userId" foreign="id" />
    </foreign-key>
 </table>

  <table name="users_userGroup" phpName='UserGroup' description="Users / Groups">
  <column name="userId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
  <column name="groupId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
  <foreign-key foreignTable="users_user">
     <reference local="userId" foreign="id"/>
  </foreign-key>
  <foreign-key foreignTable="users_group" onDelete="cascade">
     <reference local="groupId" foreign="id"/>
  </foreign-key>
 </table>

 <table name="users_group" phpName='Group' description="Groups">
  <column name="id" required="true"  primaryKey='true' type="INTEGER"  description="Group ID" autoIncrement="true"/>
  <column name="name" required="true"  type="VARCHAR" size="255"  description="Group Name"/>
  <column name="created" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="updated" required="true"  type="TIMESTAMP"  description="Last update date"/>
  <column name="bitLevel"   type="INTEGER"  description="Nivel"/>
	<unique>
		<unique-column name="name" />
	</unique>
 </table>

 <table name="users_level" phpName='Level' description="Levels">
  <column name="id" required="true"  primaryKey='true' type="INTEGER"  description="Level ID" autoIncrement="true"/>
  <column name="name" required="true"  type="VARCHAR" size="255"  description="Level Name"/>
  <column name="bitLevel" type="INTEGER"  description="Bit del nivel"/>
	<unique>
		<unique-column name="name" />
	</unique>
 </table>

   <table name="security_action" phpName="SecurityAction"  description="Actions del sistema">
    <column name="action" type="VARCHAR" size="100" description="Action pagina" primaryKey='true' />
	<column name="module" type="VARCHAR" size="100" description="Modulo" />
	<column name="section" type="VARCHAR" size="100" description="Seccion"/>
    <column name="access" type="INTEGER" description="El acceso a ese action" />
    <column name="accessAffiliateUser" type="INTEGER" description="El acceso a ese action para los usuarios por afiliados" />
	<column name="active" type="INTEGER" description="Si el action esta activo o no" />
    <column name="pair" type="VARCHAR" size="100" description="Par del Action" />
	<foreign-key foreignTable="security_actionLabel" >
		<reference local="action" foreign="action" />
	</foreign-key>
  </table>
  
  <table name="security_module" phpName="SecurityModule"  description="Modulos del sistema">
	<column name="module" type="VARCHAR" size="100" description="Modulo" primaryKey='true'/>
    <column name="access" type="INTEGER" description="El acceso a ese action" />
    <column name="accessAffiliateUser" type="INTEGER" description="El acceso a ese action para los usuarios por afiliados" />
  </table>

  <table name="security_actionLabel" phpName="SecurityActionLabel"  description="etiquetas de actions de seguridad">
    	<column name="id" type="INTEGER"  required="true" description="Id label security" primaryKey="true" autoIncrement="true"  />
	<column name="action" type="VARCHAR" size="100" description="Action pagina" primaryKey='true' />
	<column name="language" type="VARCHAR" size="100" description="Idioma de la etiqueta" />
	<column name="label" type="VARCHAR" size="100" description="Etiqueta"/>
  </table>

  <table name="affiliates_affiliate" phpName="Affiliate"  description="Afiliados">
	 <column name="id" required="true" primaryKey="true" type="INTEGER" description="Id afiliado" autoIncrement="true"/>
	 <column name="name" required="true"  type="VARCHAR" size="255" description="nombre afiliado"/>
   <column name="ownerId" type="INTEGER" description="Id del usuario administrador del afiliado" />
    <foreign-key foreignTable="affiliates_affiliateInfo" >
    <reference local="id" foreign="affiliateId" />
  </foreign-key>
  </table>

  <table name="affiliates_affiliateInfo" phpName="AffiliateInfo"  description="Informacion del afiliado">
    <column name="affiliateId" primaryKey="true" required="true" type="INTEGER" description="Id afiliado"/>
    <column name="affiliateInternalNumber" required="true" type="INTEGER" description="Id interno"/>
    <column name="address" type="VARCHAR" size="255" description="Direccion afiliado"/>
    <column name="phone" type="VARCHAR" size="50" description="Telefono afiliado"/>
    <column name="email" type="VARCHAR" size="50" description="Email afiliado"/>
    <column name="contact" type="VARCHAR" size="50" description="Nombre de persona de contacto"/>
    <column name="contactEmail" type="VARCHAR" size="100" description="Email de persona de contacto"/>
    <column name="web" type="VARCHAR" size="255" description="Direccion web del afiliado"/>
    <column name="memo" type="LONGVARCHAR" description="Informacion adicional del afiliado"/>
    <foreign-key foreignTable="affiliates_affiliate" >
      <reference local="affiliateId" foreign="id" />
    </foreign-key>
  </table>




 <table name="affiliates_user" phpName='AffiliateUser' description="Usuarios de afiliado">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="User Id" autoIncrement="true"/>
 <column name="affiliateId" required="true" type="INTEGER" description="Id afiliado"/>
  <column name="username" required="true"  type="VARCHAR" size="255" description="username"/>
  <column name="password" required="true"  type="VARCHAR" size="255" description="password"/>
  <column name="active" required="true"  type="BOOLEAN"  description="Is user active?"/>
  <column name="created" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="updated" required="true"  type="TIMESTAMP"  description="Last update date"/>
  <column name="levelId" type="INTEGER" description="User Level" />
  <column name="lastLogin" type="TIMESTAMP" description="Fecha del ultimo login del usuario" />
	<unique>
		<unique-column name="username" />
	</unique>
  <foreign-key foreignTable="affiliates_userInfo" >
    <reference local="id" foreign="userId" />
  </foreign-key>
  <foreign-key foreignTable="affiliates_level" >
    <reference local="levelId" foreign="id" />
  </foreign-key>
  	<foreign-key foreignTable="affiliates_affiliate" >
		<reference local="affiliateId" foreign="id" />
	</foreign-key>
 </table>
 
 <table name="affiliates_userInfo" phpName='AffiliateUserInfo' description="Information about users by affiliates">
  <column name="userId" required="true" primaryKey="true" type="INTEGER" description="User Id" />
  <column name="name" type="VARCHAR" size="255" description="name"/>
  <column name="surname" type="VARCHAR" size="255" description="surname"/>
  <column name="mailAddress" type="VARCHAR" size="255" description="Email" />
	<foreign-key foreignTable="affiliates_user" >
      <reference local="userId" foreign="id" />
    </foreign-key>
 </table>
 
 <table name="affiliates_level" phpName='AffiliateLevel' description="Levels">
  <column name="id" required="true"  primaryKey='true' type="INTEGER"  description="Level ID" autoIncrement="true"/>
  <column name="name" required="true"  type="VARCHAR" size="255"  description="Level Name"/>
  <column name="bitLevel" type="INTEGER"  description="Bit del nivel"/>
	<unique>
		<unique-column name="name" />
	</unique>
 </table>
 
  <table name="affiliates_userGroup" phpName='AffiliateUserGroup' description="Users / Groups">
  <column name="userId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
  <column name="groupId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
  <foreign-key foreignTable="affiliates_user">
     <reference local="userId" foreign="id"/>
  </foreign-key>
  <foreign-key foreignTable="affiliates_group" onDelete="cascade">
     <reference local="groupId" foreign="id"/>
  </foreign-key>
 </table>

 <table name="affiliates_group" phpName='AffiliateGroup' description="Groups">
  <column name="id" required="true"  primaryKey='true' type="INTEGER"  description="Group ID" autoIncrement="true"/>
  <column name="name" required="true"  type="VARCHAR" size="255"  description="Group Name"/>
  <column name="created" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="updated" required="true"  type="TIMESTAMP"  description="Last update date"/>
  <column name="bitLevel"   type="INTEGER"  description="Nivel"/>
	<unique>
		<unique-column name="name" />
	</unique>
 </table>
 
  <table phpName="Category" name="category" description="Categorias" >
    <column autoIncrement="true" type="INTEGER" name="id" required="true" description="" primaryKey='true' />
    <column size="255" type="VARCHAR" name="name" required="true" description="Category name" />
    <column type="BOOLEAN" name="active" required="true" description="Is category active?" />
  </table>
  
 <table name="users_groupCategory" phpName='GroupCategory' description="Groups / Categories">
  <column name="groupId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
  <column name="categoryId" required="true" primaryKey='true' type="INTEGER"  description="Category ID"/>
  <foreign-key foreignTable="users_group" onDelete="cascade">
     <reference local="groupId" foreign="id"/>
  </foreign-key>
  <foreign-key foreignTable="category">
     <reference local="categoryId" foreign="id"/>
  </foreign-key>
 </table>
 
 <table name="affiliates_groupCategory" phpName='AffiliateGroupCategory' description="Groups / Categories">
  <column name="groupId" required="true" primaryKey='true' type="INTEGER"  description="Group ID"/>
  <column name="categoryId" required="true" primaryKey='true' type="INTEGER"  description="Category ID"/>
  <foreign-key foreignTable="affiliates_group" onDelete="cascade">
     <reference local="groupId" foreign="id"/>
  </foreign-key>
  <foreign-key foreignTable="category">
     <reference local="categoryId" foreign="id"/>
  </foreign-key>
 </table>


<table name="modules_module" phpName='Module' description=" Registro de modulos">
	<column name="name" required="true" primaryKey='true' size="255" type="VARCHAR"  description="nombre del modulo"/>
	<column name="active" required="true" type="BOOLEAN"  default="0" description="Estado del modulo"/>
	<column name="alwaysActive" required="true" type="BOOLEAN"  default="0" description="Modulo siempre activo"/>
 </table>

 <table name="modules_dependency" phpName='ModuleDependency' description="Dependencia de modulos ">
	<column size="255" type="VARCHAR" primaryKey='true' name="moduleName" description="Modulo" />
	<column size="255" type="VARCHAR" primaryKey='true' name="dependence" description="Modulos de los cuales depende" />
	<foreign-key foreignTable="modules_module" onDelete="cascade">
		<reference local="moduleName" foreign="name"/>
	</foreign-key>
 </table>

 <table name="modules_label" phpName='ModuleLabel' description="Etiquetas de modulos ">
 	<column name="id" type="INTEGER"  required="true" description="Id module label" primaryKey="true" autoIncrement="true"  />
	<column name="name" required="true" primaryKey='true' size="255" type="VARCHAR"  description="nombre del modulo"/>
	<column size="255" type="VARCHAR" name="label" description="Etiqueta" />
	<column size="255" type="VARCHAR" name="description" description="Descripcion del modulo" />
	<column name="language" type="VARCHAR" size="100" description="idioma de la etiqueta"/>
	<foreign-key foreignTable="modules_module" onDelete="cascade">
		<reference local="name" foreign="name"/>
	</foreign-key> 
 </table>


<table phpName="ActionLog" name="actionLogs_log" description="logs del sistema">
	<column name="id" type="INTEGER"  required="true" description="Id log" primaryKey="true" autoIncrement="true"  />
	<column name="userId" type="INTEGER"  required="true" description="Id del usuario" />
	<column name="affiliateId" type="INTEGER"  required="true" description="Id del afiliado" />
	<column name="datetime" type="TIMESTAMP"  required="true" description="Fecha en que se logueo el dato" />
	<column name="action" type="VARCHAR" size="100"  required="true" description="action en que se logueo el dato" />
	<column name="object" type="VARCHAR" size="100"  required="true" description="objeto sobre el cual se realizo la accion"/>
	<column name="forward" type="VARCHAR" size="100" description="tipo de accion de la etiqueta"/>
	<foreign-key foreignTable="users_user" >
		<reference local="userId" foreign="id" />
	</foreign-key>
	<foreign-key foreignTable="security_action" >
		<reference local="action" foreign="action" />
	</foreign-key>
</table>


<table phpName="ActionLogLabel" name="actionLogs_label" description="Etiquetas de logueo">
	<column name="id" type="INTEGER"  required="true" description="Id Label" primaryKey="true" autoIncrement="true"  />
	<column name="action" primaryKey="true" type="VARCHAR" size="100"  required="true" description="action en que se loguea el dato" />
	<column name="label" type="VARCHAR" size="100"  required="true" description="mensaje del log"/>
	<column name="language" type="VARCHAR" size="100" description="idioma de la etiqueta"/>
	<column name="forward" type="VARCHAR" size="100" description="tipo de accion de la etiqueta"/>
</table>

	<!--Tablas particulares del sistema de importaciones-->


 <table name="request" phpName='Request' description="Requests">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="Request Id" autoIncrement="true"/>
  <column name="createdAt" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="userId" type="INTEGER" description="User" required="true" />
  <column name="status" type="INTEGER" description="Request Status" required="true" />
  <column name="timestampStatus" type="TIMESTAMP" description="Fecha del ultimo cambio de status" />
  <foreign-key foreignTable="users_user" >
    <reference local="userId" foreign="id" />
  </foreign-key>
 </table>

 <table name="productRequest" phpName='ProductRequest' description="Products of each request">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="ProductRequest Id" autoIncrement="true"/>
  <column name="requestId" type="INTEGER" description="Request" required="true" />
  <column name="productId" type="INTEGER" description="Product" required="true" />  
  <column name="supplierId" type="INTEGER" description="Supplier" />
  <column name="quantity" type="INTEGER" description="Cantidad del producto en el pedido" />
  <column name="priceSupplier" type="FLOAT" description="Precio del proveedor" />
  <column name="timestampPriceSupplier" type="TIMESTAMP" description="Fecha de la ultima modificacion del priceSupplier" />
  <column name="priceClient" type="FLOAT" description="Precio para el cliente" />
  <column name="timestampPriceClient" type="TIMESTAMP" description="Fecha de la ultima modificacion del priceClient" />
  <column name="icotermId" type="INTEGER" description="Icoterm" />
  <column name="portId" type="INTEGER" description="Port" />
  <column name="status" type="INTEGER" description="Request Status" required="true" />
  <column name="timestampStatus" type="TIMESTAMP" description="Fecha del ultimo cambio de status" />
  <foreign-key foreignTable="request" >
    <reference local="requestId" foreign="id" />
  </foreign-key>
  <foreign-key foreignTable="product" >
    <reference local="productId" foreign="id" />
  </foreign-key>
  <foreign-key foreignTable="supplier" >
    <reference local="supplierId" foreign="id" />
  </foreign-key>
  <foreign-key foreignTable="icoterm" >
    <reference local="icotermId" foreign="id" />
  </foreign-key>
  <foreign-key foreignTable="port" >
    <reference local="portId" foreign="id" />
  </foreign-key>
 </table>
 
 <table name="productRequestConfirmation" phpName='ProductRequestConfirmation' description="Confirmacion por parte del cliente a cada pedido de producto">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="ProductRequestConfirmation Id" autoIncrement="true"/>
  <column name="productRequestId" type="INTEGER" description="Product Request" required="true" />
  <column name="createdAt" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="userId" type="INTEGER" description="User" required="true" />
  <column name="attach" size="255" type="VARCHAR" description="Nombre del archivo adjunto" />
  <foreign-key foreignTable="productRequest" >
    <reference local="productRequestId" foreign="id" />
  </foreign-key>
  <foreign-key foreignTable="affiliates_user" >
    <reference local="userId" foreign="id" />
  </foreign-key>
 </table>
 
 <table name="comment" phpName='Comment' description="Comentarios">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="ProductRequestConfirmation Id" autoIncrement="true"/>
  <column name="productRequestId" type="INTEGER" description="Product Request" required="true" />
  <column name="createdAt" required="true"  type="TIMESTAMP"  description="Creation date for"/>
  <column name="userId" type="INTEGER" description="User" required="true" />
  <column name="text" type="LONGVARCHAR" description="Texto del comentario" />
  <column name="type" type="TINYINT" description="Client|Supplier" required="true" />
  <foreign-key foreignTable="productRequest" >
    <reference local="productRequestId" foreign="id" />
  </foreign-key>
	<!-- 
		El join con user hay que hacerlo manualmente porque depende del tipo de comentario el tipo de usuario.
		Aca es posible que sea necesario agregar otros tipos de comentarios para indicar si el comentario es entre Client y Anmaga, entre Anmaga y Client, entre Anmaga y Supplier, entre Supplier y Anmaga.
	-->
 </table>
 
 <table name="product" phpName='Product' description="Productos">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="Product Id" autoIncrement="true"/>
  <column name="code" size="255" type="VARCHAR" description="Codigo del producto" />
  <column name="name" size="255" type="VARCHAR" description="Nombre del producto" />
  <column name="description" type="LONGVARCHAR" description="Descripcion del producto" />
  <column name="supplierId" type="INTEGER" description="Supplier" />
  <column type="BOOLEAN" name="active" required="true" description="Is product active?" />
  <foreign-key foreignTable="supplier" >
    <reference local="supplierId" foreign="id" />
  </foreign-key>
 </table>
 
 <table name="port" phpName='Port' description="Puerto">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="Port Id" autoIncrement="true"/>
  <column name="code" size="255" type="VARCHAR" description="Codigo del puerto" />
  <column name="name" size="255" type="VARCHAR" description="Nombre del puerto" />
  <column type="BOOLEAN" name="active" required="true" description="Is port active?" />
 </table>

 <table name="icoterm" phpName='Icoterm' description="Icoterm">
  <column name="id" required="true" primaryKey="true" type="INTEGER" description="Tcoterm Id" autoIncrement="true"/>
  <column name="name" size="255" type="VARCHAR" description="Nombre del Tcoterm" />
  <column name="description" size="255" type="VARCHAR" description="Descripcion del Tcoterm" />  
  <column type="BOOLEAN" name="active" required="true" description="Is icoterm active?" />
 </table>
 
  <table phpName="Supplier" name="supplier" description="Proveedores" >
    <column autoIncrement="true" type="INTEGER" name="id" required="true" description="" primaryKey='true' />
    <column size="255" type="VARCHAR" name="name" required="true" description="Nombre" />
    <column type="BOOLEAN" name="active" required="true" description="Is supplier active?" />
  </table>

 <table name="SupplierUser" phpName='SupplierUser' description="Users / Suppliers">
  <column name="userId" required="true" primaryKey='true' type="INTEGER"  description="User ID"/>
  <column name="supplierId" required="true" primaryKey='true' type="INTEGER"  description="Supplier ID"/>
  <foreign-key foreignTable="users_user" onDelete="cascade">
     <reference local="userId" foreign="id"/>
  </foreign-key>
  <foreign-key foreignTable="supplier">
     <reference local="supplierId" foreign="id"/>
  </foreign-key>
 </table>

</database>
